syntax = "proto3";

package infraboard.mpaas.approval;
option go_package = "github.com/infraboard/mpaas/apps/approval";

import "common/meta/meta.proto";
import "apps/approval/pb/deploy.proto";

message ApprovalSet {
    // 总数
    // @gotags: bson:"total" json:"total"
    int64 total = 1;
    // 列表
    // @gotags: bson:"items" json:"items"
    repeated Approval items = 2;
}

// 发布申请单
message Approval  {
    // 元信息
    // @gotags: bson:",inline" json:"meta"
    common.meta.Meta meta = 1;
    // 创建信息
    // @gotags: bson:",inline" json:"spec"
    CreateApprovalRequest spec = 2;
    // 发布单当前状态
    // @gotags: bson:"status" json:"status"
    Status status = 3;
}

// 创建发布申请
message CreateApprovalRequest {
    // 是否是模版
    // @gotags: bson:",inline" json:"meta"
    bool is_template = 1;
    // 申请人列表, 申请通过后, 由申请人执行发布
    // @gotags: bson:"proposers" json:"proposers"
    repeated string proposers = 2;
    // 审核人列表
    // @gotags: bson:"auditors" json:"auditors"
    repeated string auditors = 3;
    // 发布号
    // @gotags: bson:"version" json:"version"
    string version = 4;
    // 发布说明
    // @gotags: bson:"describe" json:"describe"
    string describe = 5;
    // 审核通过后, 是否自动执行发布
    // @gotags: bson:"auto_publish" json:"auto_publish"
    bool auto_publish = 6;
    // 部署清单
    // @gotags: bson:"deploy_list" json:"deploy_list"
    DeployList deploy_list = 7;
}

message Status {
    // 当前状态
    // @gotags: bson:"stage" json:"stage"
    STAGE stage = 1;
    // 审核通过的时间
    // @gotags: bson:"pass_at" json:"pass_at"
    int64 pass_at = 2;
    // 审核通过的意见
    // @gotags: bson:"comment" json:"comment"
    string comment = 3;
    // 开始发布的时间
    // @gotags: bson:"publish_at" json:"publish_at"
    int64 publish_at = 4;
    // 发布结束的时间
    // @gotags: bson:"end_at" json:"end_at"
    int64 end_at = 5;
    // 发布关闭的时间
    // @gotags: bson:"close_at" json:"close_at"
    int64 close_at = 6;
}