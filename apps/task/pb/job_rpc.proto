syntax = "proto3";

package infraboard.mpaas.task;
option go_package = "github.com/infraboard/mpaas/apps/task";

import "apps/task/pb/job_task.proto";
import "apps/pipeline/pb/pipeline.proto";
import "github.com/infraboard/mcube/pb/page/page.proto";

// RPC 执行Job
service JobRPC {
    // 执行Job
    rpc RunJob(pipeline.RunJobRequest) returns(JobTask);

    // 查询任务
    rpc QueryJobTask(QueryJobTaskRequest) returns(JobTaskSet);
    // 更新任务
    rpc UpdateJobTaskStatus(UpdateJobTaskStatusRequest) returns(JobTask);
    // 任务执行详情
    rpc DescribeJobTask(DescribeJobTaskRequest) returns(JobTask);
    // 删除任务
    rpc DeleteJobTask(DeleteJobTaskRequest) returns(JobTask);
}

message QueryJobTaskRequest {
    // 分页请求
    // @gotags: json:"page"
    mcube.page.PageRequest page = 1;
    // 任务Id列表
    // @gotags: json:"ids"
    repeated string ids = 2;
	// 与该pipeline task关联的任务
	// @gotags: json:"id"
    string pipeline_task_id = 3;
}

message UpdateJobTaskStatusRequest {
	// 任务Id
	// @gotags: json:"id"
    string id = 1;
	// 任务当前状态
	// @gotags: bson:"stage" json:"stage"
    STAGE stage = 2;
	// 状态描述
	// @gotags: bson:"message" json:"message"
	string message = 3;
	// 任务状态详细描述, 用于Debug
	// @gotags: bson:"detail" json:"detail"
	string detail = 4;
}

message DescribeJobTaskRequest {
	// 任务Id
	// @gotags: json:"id"
    string id = 1;
}

message DeleteJobTaskRequest {
	// 任务Id
	// @gotags: json:"id"
    string id = 1;
}